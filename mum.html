<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Christmas Connections</title>

    <!-- 1. The Logo (Favicon) -->
    <link rel="icon" type="image/png" href="favicon.png">

    <!-- 2. iPhone (iOS) App Settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Xmas Connect">
    <link rel="apple-touch-icon" href="logo.svg">

    <!-- 3. Android (PWA) App Settings -->
    <meta name="theme-color" content="#FAFAF5">
    <link rel="manifest" href="manifest.json">
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <!-- Fonts: Libre Franklin (Classic Connections Font) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@400;500;700;800&display=swap" rel="stylesheet">

    <style>
        /* Base Styles */
        body { 
            font-family: 'Libre Franklin', sans-serif; 
            background-color: #FAFAF5; /* Warm, premium off-white */
            color: #1a1a1b;
            touch-action: manipulation; 
            -webkit-tap-highlight-color: transparent; 
        }
        
        /* Custom Gold Palette */
        .text-gold { color: #C5A059; }
        .bg-gold { background-color: #C5A059; }
        .border-gold { border-color: #C5A059; }
        .hover-bg-gold:hover { background-color: #B08D4B; }
        
        /* Animations */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .animate-shake { animation: shake 0.2s ease-in-out 0s 2; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Modal Animation */
        .modal-enter { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        /* Shimmer Effect for Title */
        .shimmer-text {
            background: linear-gradient(45deg, #000 20%, #C5A059 50%, #000 80%);
            background-size: 200% auto;
            color: #000;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shimmer 3s linear infinite;
        }
        @keyframes shimmer { to { background-position: 200% center; } }
    </style>
</head>
<body class="min-h-screen select-none">

    <div id="root"></div>

    <!-- SCRIPT: iOS Standalone Link Fix (Keeps navigation inside the App) -->
    <script>
        if (("standalone" in window.navigator) && window.navigator.standalone) {
            var a = document.getElementsByTagName("a");
            for (var i = 0; i < a.length; i++) {
                a[i].addEventListener("click", function(event) {
                    var href = this.getAttribute("href");
                    if (href && !href.startsWith("http") && !href.startsWith("#")) {
                        event.preventDefault();
                        window.location = href;
                    }
                }, false);
            }
        }
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ==========================================
        // ðŸŽ„ CONFIGURATION ðŸŽ„
        // ==========================================
        
        const RECIPIENT_NAME = "MUM"; 

        const PUZZLE_DATA = [
            {
                level: 0, // Yellow
                category: 'ROYALS',
                members: ['CHARLES', 'ALBERT', 'SOPHIE', 'BILLY'],
            },
            {
                level: 1, // Green
                category: 'MALE SINGERS',
                members: ['SAM', 'TOM', 'GENE', 'OLLIE'],
            },
            {
                level: 2, // Blue
                category: 'VERBS AT START',
                members: ['HUGO', 'STEPHANIE', 'MARNIE', 'STANLEY'],
            },
            {
                level: 3, // Purple
                category: 'FIRST LETTERS MAKE A WORD',
                members: ['AVA', 'HOWARD', 'BEKKI', 'HARRIET'],
            },
        ];

        // ==========================================
        //       APP LOGIC
        // ==========================================

        // RECOLORED: Regal/Jewel tones instead of primary colors
        const COLORS = {
            0: 'bg-[#E3D18A]', // Champagne Gold (Easy)
            1: 'bg-[#A3B18A]', // Sage Green (Medium)
            2: 'bg-[#8FA6CB]', // Winter Blue (Hard)
            3: 'bg-[#B58AA5]', // Antique Plum (Hardest)
        };

        const EMOJIS = { 0: 'ðŸŸ¨', 1: 'ðŸŸ©', 2: 'ðŸŸ¦', 3: 'ðŸŸª' };

        // Help Modal
        const HelpModal = ({ onClose }) => (
            <div className="fixed inset-0 bg-white/95 z-50 flex flex-col items-center justify-center p-6 modal-enter">
                <div className="max-w-md w-full space-y-6 relative">
                    <button onClick={onClose} className="absolute -top-12 right-0 p-2 bg-gray-100 rounded-full">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                    </button>
                    
                    <h2 className="text-3xl font-bold text-center">How to Play</h2>
                    
                    <div className="space-y-4 text-sm font-medium">
                        <p>Think of this as your very own episode of <em>Only Connect</em>.</p>
                        <p>Just like Victoria Coren Mitchell (that nice lady we want to invite over for tea) would want, your task is to sort the clues into four groups of four.</p>
                        
                        <div className="bg-gray-50 p-4 rounded-lg text-left mx-auto">
                            <ul className="list-disc pl-4 space-y-2">
                                <li>Tap four items that share a connection.</li>
                                <li>Press 'Submit' to check if youâ€™ve found the link.</li>
                            </ul>
                        </div>
                    </div>

                    <div className="space-y-2">
                        <p className="font-bold text-sm">Category Examples</p>
                        <div className="text-xs space-y-1 text-gray-500 font-medium">
                            <p>Jonesâ€™: Katherine (Zeta), Peter (Dragons Den), Tom, Toby</p>
                            <p>First 3 letters are a word: Matthew, Peter, Caroline, Rima</p>
                        </div>
                    </div>
                    
                    <button onClick={onClose} className="w-full bg-gold text-white py-3 rounded-full font-bold uppercase tracking-wider hover:bg-[#B08D4B] transition-colors">
                        Thank you darling!
                    </button>
                </div>
            </div>
        );

        const App = () => {
            const [items, setItems] = useState([]);
            const [selected, setSelected] = useState([]);
            const [solvedGroups, setSolvedGroups] = useState([]);
            const [mistakes, setMistakes] = useState(4);
            const [isShaking, setIsShaking] = useState(false);
            const [message, setMessage] = useState(null);
            const [guessHistory, setGuessHistory] = useState([]);
            const [showHelp, setShowHelp] = useState(false);
            const [infiniteMode, setInfiniteMode] = useState(false);

            // Helper: Shuffle Array
            const shuffle = (array) => {
                const newArr = [...array];
                for (let i = newArr.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
                }
                return newArr;
            };

            // 1. Initialize Game
            useEffect(() => {
                const savedData = localStorage.getItem('christmasConnectGold_' + RECIPIENT_NAME);

                if (savedData) {
                    try {
                        const data = JSON.parse(savedData);
                        setSolvedGroups(data.solvedGroups || []);
                        setMistakes(data.mistakes !== undefined ? data.mistakes : 4);
                        setGuessHistory(data.guessHistory || []);
                        setInfiniteMode(data.infiniteMode || false); 

                        const solvedWords = (data.solvedGroups || []).flatMap(g => g.members);
                        const allWords = PUZZLE_DATA.flatMap((group) =>
                            group.members.map((word) => ({ text: word, level: group.level }))
                        );
                        const remainingItems = allWords.filter(item => !solvedWords.includes(item.text));
                        setItems(shuffle(remainingItems));
                    } catch (e) {
                        const allWords = PUZZLE_DATA.flatMap((group) =>
                            group.members.map((word) => ({ text: word, level: group.level }))
                        );
                        setItems(shuffle(allWords));
                    }
                } else {
                    const allWords = PUZZLE_DATA.flatMap((group) =>
                        group.members.map((word) => ({ text: word, level: group.level }))
                    );
                    setItems(shuffle(allWords));
                }
            }, []);

            // 2. Auto-Save
            useEffect(() => {
                if (items.length > 0 || solvedGroups.length > 0) {
                    const gameState = { solvedGroups, mistakes, guessHistory, infiniteMode };
                    localStorage.setItem('christmasConnectGold_' + RECIPIENT_NAME, JSON.stringify(gameState));
                }
            }, [solvedGroups, mistakes, guessHistory, infiniteMode, items]);

            // Confetti
            useEffect(() => {
                if (solvedGroups.length === 4) {
                    confetti({
                        particleCount: 200,
                        spread: 70,
                        origin: { y: 0.6 },
                        colors: ['#C5A059', '#ff0000', '#00ff00'] // Gold, Red, Green
                    });
                }
            }, [solvedGroups]);

            const handleSelect = (word) => {
                if (selected.includes(word)) {
                    setSelected(selected.filter((w) => w !== word));
                } else if (selected.length < 4) {
                    setSelected([...selected, word]);
                }
            };

            const handleReset = () => {
                if (window.confirm("Are you sure you want to reset the puzzle? You'll lose all progress.")) {
                    localStorage.removeItem('christmasConnectGold_' + RECIPIENT_NAME);
                    window.location.reload();
                }
            };

            const showToast = (msg) => {
                setMessage(msg);
                setTimeout(() => setMessage(null), 3000);
            };

            const handleSubmit = () => {
                if (selected.length !== 4) return;

                const selectedItems = items.filter((item) => selected.includes(item.text));
                const levels = selectedItems.map((item) => item.level);
                setGuessHistory([...guessHistory, levels]);

                const allSameLevel = levels.every((l) => l === levels[0]);

                if (allSameLevel) {
                    const level = levels[0];
                    const group = PUZZLE_DATA.find((g) => g.level === level);
                    setSolvedGroups([...solvedGroups, group]);
                    setItems(items.filter((item) => !selected.includes(item.text)));
                    setSelected([]);

                    if (solvedGroups.length === 3) {
                        showToast('Excellent!');
                    }
                } else {
                    setIsShaking(true);
                    setTimeout(() => setIsShaking(false), 500);
                    
                    if (!infiniteMode) {
                        const newMistakes = mistakes - 1;
                        setMistakes(newMistakes);

                        if (newMistakes === 0) {
                            setInfiniteMode(true);
                            setMistakes(999); 
                            showToast('Out of lives! but I â¤ï¸ U. Infinite lives!');
                            return; 
                        }
                    }

                    const counts = {};
                    levels.forEach(l => counts[l] = (counts[l] || 0) + 1);
                    if (Object.values(counts).some(count => count === 3)) {
                        showToast('One away...');
                    }
                }
            };

            const handleShare = async () => {
                let grid = `Christmas Connections\n${RECIPIENT_NAME}'s Puzzle\n`;
                guessHistory.forEach(guess => {
                    grid += guess.map(level => EMOJIS[level]).join('') + '\n';
                });

                try {
                    if (navigator.share) {
                        await navigator.share({ title: 'Christmas Connections', text: grid });
                    } else {
                        await navigator.clipboard.writeText(grid);
                        showToast('Copied to clipboard!');
                    }
                } catch (err) { console.log('Share failed', err); }
            };

            return (
                <div className="flex flex-col items-center min-h-screen relative p-4 lg:p-6 max-w-lg mx-auto">
                    
                    {/* Help Modal */}
                    {showHelp && <HelpModal onClose={() => setShowHelp(false)} />}

                    {/* Header */}
                    <header className="w-full flex justify-between items-center py-4 border-b border-gray-200 mb-6">
                        
                        {/* LEFT: Back Button to Index */}
                        <a href="index.html" className="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors text-gray-600">
                             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
                        </a>
                        
                        <div className="text-center">
                            {/* Gold Shimmer Title */}
                            <h1 className="text-3xl font-bold tracking-tight shimmer-text">Connections</h1>
                            <p className="text-xs font-bold uppercase tracking-widest text-gold mt-1">Edition for {RECIPIENT_NAME}</p>
                        </div>
                        
                        {/* RIGHT: Help Button */}
                        <button onClick={() => setShowHelp(true)} className="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors text-black">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
                        </button>
                    </header>

                    {/* Toast */}
                    {message && (
                        <div className="fixed top-20 left-0 right-0 mx-auto w-fit bg-black text-white px-6 py-3 rounded-md shadow-xl z-50 font-bold animate-bounce">
                            {message}
                        </div>
                    )}

                    {/* Solved Groups */}
                    <div className="w-full space-y-2 mb-3">
                        {solvedGroups.map((group) => (
                            <div key={group.level} className={`${COLORS[group.level]} w-full min-h-[5rem] rounded-md flex flex-col items-center justify-center p-3 fade-in shadow-sm`}>
                                {/* Category Title: Centered, Bold, Removed Uppercase Enforcement */}
                                <h3 className="font-bold text-sm mb-1 text-center leading-tight">{group.category}</h3>
                                <p className="text-center text-sm font-medium opacity-90">{group.members.join(', ')}</p>
                            </div>
                        ))}
                    </div>

                    {/* Game Grid */}
                    <div className={`grid grid-cols-4 gap-2 w-full mb-8 ${isShaking ? 'animate-shake' : ''}`}>
                        {items.map((item) => (
                            <button
                                key={item.text}
                                onClick={() => handleSelect(item.text)}
                                className={`
                                    aspect-square rounded-md flex items-center justify-center p-1 font-bold uppercase transition-all duration-200 select-none
                                    ${selected.includes(item.text) 
                                        ? 'bg-gold text-white shadow-inner scale-95' 
                                        : 'bg-[#efefe6] hover:bg-[#d5d5cd] text-black'}
                                `}
                            >
                                <span className={`
                                    text-[11px] sm:text-[13px] text-center
                                    ${item.text.length > 8 ? 'tracking-tighter' : 'tracking-normal'}
                                `}>
                                    {item.text}
                                </span>
                            </button>
                        ))}
                    </div>

                    {/* Controls */}
                    <div className="flex flex-col items-center w-full mt-auto pb-8">
                        
                        {/* Mistakes Bubbles */}
                        <div className="flex items-center gap-3 mb-6">
                            <span className="text-sm font-medium">Mistakes remaining:</span>
                            <div className="flex gap-2 items-center">
                                {infiniteMode ? (
                                     <span className="text-2xl font-bold text-gold animate-pulse">âˆž</span>
                                ) : (
                                    [...Array(4)].map((_, i) => (
                                        <div key={i} className={`w-3 h-3 rounded-full transition-colors ${i < mistakes ? 'bg-gold' : 'bg-gray-300'}`} />
                                    ))
                                )}
                            </div>
                        </div>

                        {/* Buttons */}
                        <div className="flex gap-2 justify-center w-full mb-8">
                            <button onClick={() => setItems(shuffle([...items]))} disabled={solvedGroups.length === 4} 
                                className="px-5 py-3 border border-gold text-gold rounded-full text-xs font-bold uppercase hover:bg-gold hover:text-white transition-colors disabled:opacity-30">
                                Shuffle
                            </button>
                            <button onClick={() => setSelected([])} disabled={solvedGroups.length === 4 || selected.length === 0} 
                                className="px-5 py-3 border border-gold text-gold rounded-full text-xs font-bold uppercase hover:bg-gold hover:text-white transition-colors disabled:opacity-30">
                                Deselect
                            </button>
                            <button onClick={handleSubmit} disabled={solvedGroups.length === 4 || selected.length !== 4} 
                                className={`px-5 py-3 rounded-full text-xs font-bold uppercase transition-colors border
                                ${selected.length === 4 
                                    ? 'bg-gold border-gold text-white hover:bg-[#B08D4B]' 
                                    : 'border-gray-300 text-gray-300'}`}>
                                Submit
                            </button>
                        </div>
                        
                        {/* Reset */}
                        <div className="mb-4">
                            <button 
                                onClick={handleReset}
                                className="text-[10px] text-gray-400 underline uppercase tracking-widest hover:text-red-500"
                            >
                                Reset Puzzle
                            </button>
                        </div>

                        {/* Results & Share */}
                        {(solvedGroups.length === 4) && (
                            <div className="flex flex-col items-center w-full mt-2 space-y-6 fade-in">
                                <div className="flex flex-col items-center p-4 bg-white rounded-lg border border-gray-100 shadow-sm w-full max-w-xs">
                                    <h3 className="font-bold uppercase text-xs mb-3 text-gold tracking-widest">Puzzle Solved</h3>
                                    <div className="flex flex-col gap-1">
                                        {guessHistory.map((guess, i) => (
                                            <div key={i} className="flex gap-1">
                                                {guess.map((level, j) => (
                                                    <div key={j} className={`w-6 h-6 rounded-sm ${COLORS[level]}`}></div>
                                                ))}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                
                                <button onClick={handleShare} className="bg-gold text-white px-8 py-3 rounded-full text-sm font-bold uppercase tracking-widest shadow-lg hover:bg-[#B08D4B] transition-all transform hover:-translate-y-1">
                                    Share Score ðŸŽ„
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


